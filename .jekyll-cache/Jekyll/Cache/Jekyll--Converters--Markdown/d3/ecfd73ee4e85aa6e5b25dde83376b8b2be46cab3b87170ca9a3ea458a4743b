I"<h3 id="coroutine--"><strong>Coroutine ?</strong> <br /></h3>

<p>Work with Background thread <br />
Coroutineì€ AsyncTask ì™€ ê°™ì´ Threadingí•˜ëŠ” ë°©ë²• ì¤‘ì— í•˜ë‚˜ì´ë‹¤.<br /></p>

<p><strong>â€» ì•„ë˜ì™€ ê°™ì€ ìƒí™©ì—ì„œ Coroutineì€ ìœ ìš©í•˜ê²Œ ì“°ì¸ë‹¤.</strong><br />
â‘  Request to network retrofit volley ë“±ì˜ í†µì‹  ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í• ë•Œ, Main Threadê°€ Blockëœë‹¤.<br />
â‘¡ Accessing the internal SQLite database on the phone. ex) Room database<br /></p>

<p><strong><font color="Red">ìœ„ì˜ ë‘ê°€ì§€ ê²½ìš°ì—ì„œ ì¼ë°˜ì ìœ¼ë¡œ background threadê°€ ì‚¬ìš©ì´ ëœë‹¤.</font></strong><br /></p>

<p>simulate network request and internal room database.<br /></p>

<p><strong><font color="Blue">Sequence</font></strong><br />
(1) Get the result value from background thread.<br />
(2) Take the result and then display on the main thread.<br /></p>

<p>Android ê°œë°œì„ í•˜ë‹¤ë³´ë©´ Networkë‚˜ ë‚´ë¶€ ë°ì´í„°ë² ì´ìŠ¤ë¡œë¶€í„° ë°ì´í„°ë¥¼ ì·¨ë“í•´ì„œ ìˆœì°¨ì ìœ¼ë¡œ ì·¨ë“í•œ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•´ì•¼ ë˜ëŠ” ê²½ìš°ê°€ ìˆë‹¤. <br />
ì´ëŸ° ê²½ìš°ëŠ” ì´ë¯¸ ê²½í—˜ì„ í•´ë´¤ì—ˆê¸° ë•Œë¬¸ì— ì–¼ë§ˆë‚˜ í° ë¬¸ì œì¸ì§€ ì•Œê³  ìˆë‹¤. ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„œëŠ” RxJavaë‚˜ callbackí•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ì„œ ì‘ì„±ì„ í•˜ë©´, ì½”ë“œê°€ ë§¤ìš° ë³µì¡í•´ì§€ê¸° ë•Œë¬¸ì—, Coroutineì„ ì‚¬ìš©í•´ì„œ ì‘ì„±ì„ í•˜ë©´ Simpleí•˜ê²Œ ì½”ë“œë¥¼ ì‘ì„±í•  ìˆ˜ ìˆë‹¤. <br /></p>

<p>â‘  Gradleì— Coroutineê³¼ ê´€ë ¨ëœ dependenciesë¥¼ ì¶”ê°€í•œë‹¤.<br /></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>def coroutines_version = "1.2.1"
implementation "org.jetbrains.kotlinx:kotlinx-coroutines-core:$coroutines_version"
implementation "org.jetbrains.kotlinx:kotlinx-coroutines-android:$coroutines_version"
</code></pre></div></div>

<p>â‘¡ debugìš©ìœ¼ë¡œ logë¥¼ í™•ì¸í•˜ê¸° ìœ„í•´ â€œlogThreadâ€ ë©”ì†Œë“œë¥¼ ì‘ì„±í•œë‹¤.<br /></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>private fun logThread(methodName: String){
    println("debug: ${methodName}: ${Thread.currentThread().name}")
}
</code></pre></div></div>

<p>â‘¢ í…ŒìŠ¤íŠ¸ìš©ìœ¼ë¡œ Apië¡œë¶€í„° ê²°ê³¼ê°’ì„ ê°€ì ¸ì˜¤ëŠ” ë©”ì†Œë“œ(suspend)ë¥¼ ë‘ê°œ ì‘ì„±í•œë‹¤. ì´ëŠ” ìˆœì°¨ì ìœ¼ë¡œ ì·¨ë“í•˜ëŠ” ë°ì´í„°ë¥¼ ìµœì¢…ì ìœ¼ë¡œ Main threadì˜ UIìš”ì†Œì— ë°˜ì˜í•˜ê¸° ìœ„í•¨ì´ë‹¤.<br /></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>private suspend fun getResult1FromApi():String{
    logThread("getResult1FromApi")
    delay(1000) // sleep single coroutine
    //Thread.sleep(1000) // sleep all coroutine
    return RESULT_1 // "Result #1"
}

private suspend fun getResult2FromApi(): String{
    logThread("getResult2FromApi")
    delay(1000)
    return RESULT_2 // "Result #2"
}
</code></pre></div></div>

<p>â‘£ ìœ„ì—ì„œ ì‘ì„±í•œ Apiì·¨ë“ ë©”ì†Œë“œë¥¼ fakeApiResult() ë©”ì†Œë“œ(suspend) ë‚´ì—ì„œ ì²˜ë¦¬í•˜ë„ë¡ ì‘ì„±í•œë‹¤. <br />
   ì—¬ê¸°ì„œ í…ŒìŠ¤íŠ¸í•´ë³¼ ê²ƒì€ apië¡œë¶€í„° ì·¨ë“í•œ ê°’ì„ UIìƒì— í‘œì‹œí•˜ëŠ” í…ŒìŠ¤íŠ¸ë¥¼ í•´ë³¼ ê²ƒì´ë‹¤. í•˜ì§€ë§Œ <strong>í˜„ì¬ fakeApiResult()ë©”ì†Œë“œê°€ ì‹¤í–‰ë˜ëŠ” threadëŠ” Main threadê°€ ì•„ë‹Œ Background thread</strong>ì´ë¯€ë¡œ, <strong><font color="Red">UIì—ì„œ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ì„œëŠ” ì·¨ë“í•œ ê°’ì„ "Main thread"ë¡œ ë³´ë‚´ì„œ UIì— í‘œì‹œì²˜ë¦¬í•´ì•¼ í•œë‹¤.</font></strong><br /></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>private suspend fun fakeApiResult(){
    val result1 = getResult1FromApi()
    println("debug: $result1")
    setTextOnMainThread(result1)

    // result1 ë¶€ë¶„ì´ ì²˜ë¦¬ëœ í›„ì— result2ë¶€ë¶„ì´ ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰ë  ê²ƒì´ë‹¤.
    val result2 = getResult2FromApi()
    setTextOnMainThread(result2)
    //text.setText(result1) //ì´ ì‘ì—…ì€ crash ë  ê²ƒì´ë‹¤.
    // ê·¸ ì´ìœ ëŠ” background thread ì—ì„œ ì‘ì—…ì„ í•˜ê³  ìˆê³ ,
    // ì‹¤ì œ UIì™€ interact í•˜ê³  ìˆëŠ” thread ëŠ” Main thread ì´ê¸° ë•Œë¬¸ì´ë‹¤.
}
</code></pre></div></div>

<p><strong><font color="Blue">setTextOnMainThread() ë©”ì†Œë“œ (Main threadë¡œ threadë¥¼ ì „í™˜í•˜ì—¬ ì·¨ë“í•œ ê²°ê³¼ ê°’ì„ UIë°˜ì˜í•˜ê¸°)</font></strong></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>private suspend fun setTextOnMainThread(input: String){
    //CoroutineScope(Main)ë¡œ í•˜ê±°ë‚˜
    withContext(Main){
      setNewText(input)
    }
}
</code></pre></div></div>

<p><strong><font color="Blue">UI ìƒì— ìˆëŠ” TextViewì— textë¥¼ settingí•˜ëŠ” ë©”ì†Œë“œ</font></strong></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>private fun setNewText(input: String){
    val newText = text.text.toString() + "\n$input"
    text.text = newText
}
</code></pre></div></div>

<p>â‘¤ ë§ˆì§€ë§‰ìœ¼ë¡œ onCreate()ë©”ì†Œë“œì— ì‘ì„±í•œ</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>override fun onCreate(savedInstanceState: Bundle?) {
      super.onCreate(savedInstanceState)
      setContentView(R.layout.activity_main)

      button.setOnClickListener{
          // IO(Network, local database interaction),
          // Main(Main thread, interact with UI),
          // Default(heavy competition work)
          CoroutineScope(IO).launch {
              //launch (coroutine builder)
              fakeApiResult()
          }
      }
}    
</code></pre></div></div>

<p>ì°¸ê³  : <a href="https://codelabs.developers.google.com/codelabs/kotlin-coroutines/#0">Android coroutines codelab</a></p>

<h3 id="ì „ì²´ì ì¸-í•™ìŠµë‚´ìš©ì„-ë³µìŠµí•œë‹¤">ì „ì²´ì ì¸ í•™ìŠµë‚´ìš©ì„ ë³µìŠµí•œë‹¤.<br /></h3>
<p>1.</p>
:ET